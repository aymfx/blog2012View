<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <title>pubsub-js的简单使用 | Aymfx&#39;s Blog</title>
  
  <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1408911_ujc2i49ntb.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>
  <body>
    <div class='container'>
      <header id="header">
  <section class='header-main'>
    <div class='outer'>
        <a href="/" class="logo">Aymfx's Blog</a> 
      <nav class="navbar">
        
        <a href="/" class="menu-item-link">首页</a>
        
        <a href="/archives" class="menu-item-link">归档</a>
        
        <a href="/tags" class="menu-item-link">标签</a>
        
        <a href="/about" class="menu-item-link">关于我</a>
        
        <a href="/photos" class="menu-item-link">相册</a>
        
        <a href="https://github.com/aymfx" class="menu-item-link">交友</a>
        
      </nav>
    </div>
  </section>
</header>
    <main class="main">
      <div class='post-detail'>
    <div id="toc" class='left'>
    <h4>
        文章目录
    </h4>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#发布与订阅"><span class="toc-text">发布与订阅</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#我把它运用在了一个小demo配合react"><span class="toc-text">我把它运用在了一个小demo配合react</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#官网上提供的小栗子"><span class="toc-text">官网上提供的小栗子</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Tips"><span class="toc-text">Tips</span></a></li></ol>
</div>
    <article class="post-detail animated slideInDown right">
        <div class="post-title">
          <h2 class="title">pubsub-js的简单使用</h2>
        </div>
         <div class="post-meta"> 
          <i class='iconfont iconriqi'></i>
          <span class="post-time">2016-08-20</span>
        </div>
        <div class="article-container">
          <blockquote>
<p>它是一个库，通过这个库，我们能很好的将事件事件发布出去，而不需要关心接受者是谁</p>
</blockquote>
 <a id="more"></a> 

<h1 id="发布与订阅"><a href="#发布与订阅" class="headerlink" title="发布与订阅"></a>发布与订阅</h1><blockquote>
<p>它是一个库，通过这个库，我们能很好的将事件事件发布出去，而不需要关心接受者是谁</p>
</blockquote>
<blockquote>
<p><a href="https://www.npmjs.com/package/pubsub-js" target="_blank" rel="noopener">https://www.npmjs.com/package/pubsub-js</a> 这是npm库</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/mroderick/PubSubJS" target="_blank" rel="noopener">https://github.com/mroderick/PubSubJS</a> 这是地址</p>
</blockquote>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><blockquote>
<p>cnpm i pubsub-js -S</p>
</blockquote>
<h1 id="我把它运用在了一个小demo配合react"><a href="#我把它运用在了一个小demo配合react" class="headerlink" title="我把它运用在了一个小demo配合react"></a>我把它运用在了一个小demo配合react</h1><blockquote>
<p>这是 App.js</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from <span class="string">'react'</span>;</span><br><span class="line">import logo from <span class="string">'./logo.svg'</span>;</span><br><span class="line">import <span class="string">'./App.css'</span>;</span><br><span class="line">import Alert from <span class="string">'./Alert'</span></span><br><span class="line">import PubSub from <span class="string">"pubsub-js"</span></span><br><span class="line"></span><br><span class="line">class Button extends Component&#123;</span><br><span class="line">      constructor(props)&#123;</span><br><span class="line">          super(props)</span><br><span class="line">          this.state=&#123;</span><br><span class="line">              time:<span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">          this.bundEvent=this.bundEvent.bind(this);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="title">bundEvent</span></span>() &#123;</span><br><span class="line">          this.setState(prevState =&gt; (&#123;time: !prevState.time&#125;))</span><br><span class="line">          <span class="keyword">if</span>(this.state.time)&#123;</span><br><span class="line">                PubSub.publishSync(<span class="string">"SHOW_TIME"</span>,<span class="string">"测试啦"</span>)</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              PubSub.publish(<span class="string">"HIDE_TIME"</span>,<span class="string">"继续"</span>)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="title">render</span></span>()&#123;</span><br><span class="line">          <span class="built_in">return</span> (&lt;div&gt;</span><br><span class="line">              &lt;button onClick=&#123;this.bundEvent&#125;&gt;&#123;this.props.children&#125;&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  <span class="function"><span class="title">render</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">          &lt;Alert/&gt;</span><br><span class="line">          &lt;Button&gt;大时代&lt;/Button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> default App;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这是自定义的提示，名字请忽略，没写弹窗</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from <span class="string">'react'</span>;</span><br><span class="line">import <span class="string">'./App.css'</span>;</span><br><span class="line">import PubSub from <span class="string">"pubsub-js"</span></span><br><span class="line">class Alert extends Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props)</span><br><span class="line">        this.state=&#123;</span><br><span class="line">            flag:<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Show(e) &#123;</span><br><span class="line">        console.log(e,11);</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            flag:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    Hide(e) &#123;</span><br><span class="line">        console.log(e,22);</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            flag:<span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span></span>() &#123;</span><br><span class="line">        PubSub.subscribe(<span class="string">"SHOW_TIME"</span>,this.Show.bind(this))</span><br><span class="line">        PubSub.subscribe(<span class="string">"HIDE_TIME"</span>,this.Hide.bind(this))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span></span>() &#123;</span><br><span class="line">        console.log(this.state.flag);</span><br><span class="line">        <span class="built_in">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">"App"</span> style=&#123;&#123;display:this.state.flag ? <span class="string">'block'</span> : <span class="string">'none'</span>&#125;&#125;&gt;</span><br><span class="line">                       &lt;p&gt;测试&lt;/p&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">export</span> default Alert;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> PubSub.subscribe(“SHOW_TIME”,this.Show.bind(this))  这是用来订阅一个方法</p>
</blockquote>
<blockquote>
<p> PubSub.publish(“HIDE_TIME”,”继续”) 这就是用来发布方法的了</p>
</blockquote>
<blockquote>
<p>PubSub.unsubscribe() 用来取消订阅</p>
</blockquote>
<blockquote>
<p>对于全局都需要的弹窗和tips以及loding，我们可以用这个来改，不用每次都在局部写了</p>
</blockquote>
<h1 id="官网上提供的小栗子"><a href="#官网上提供的小栗子" class="headerlink" title="官网上提供的小栗子"></a>官网上提供的小栗子</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Basic example</span><br><span class="line"></span><br><span class="line">// create a <span class="keyword">function</span> to subscribe to topics</span><br><span class="line">var mySubscriber = <span class="keyword">function</span>( msg, data )&#123;</span><br><span class="line">    console.log( msg, data );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// add the <span class="keyword">function</span> to the list of subscribers <span class="keyword">for</span> a particular topic</span><br><span class="line">// we<span class="string">'re keeping the returned token, in order to be able to unsubscribe</span></span><br><span class="line"><span class="string">// from the topic later on</span></span><br><span class="line"><span class="string">var token = PubSub.subscribe( '</span>MY TOPIC<span class="string">', mySubscriber );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// publish a topic asyncronously</span></span><br><span class="line"><span class="string">PubSub.publish( '</span>MY TOPIC<span class="string">', '</span>hello world!<span class="string">' );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// publish a topic syncronously, which is faster in some environments,</span></span><br><span class="line"><span class="string">// but will get confusing when one topic triggers new topics in the</span></span><br><span class="line"><span class="string">// same execution chain</span></span><br><span class="line"><span class="string">// USE WITH CAUTION, HERE BE DRAGONS!!!</span></span><br><span class="line"><span class="string">PubSub.publishSync( '</span>MY TOPIC<span class="string">', '</span>hello world!<span class="string">' );</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">Cancel specific subscription</span><br><span class="line"></span><br><span class="line">// create a <span class="keyword">function</span> to receive the topic</span><br><span class="line">var mySubscriber = <span class="keyword">function</span>( msg, data )&#123;</span><br><span class="line">    console.log( msg, data );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// add the <span class="keyword">function</span> to the list of subscribers to a particular topic</span><br><span class="line">// we<span class="string">'re keeping the returned token, in order to be able to unsubscribe</span></span><br><span class="line"><span class="string">// from the topic later on</span></span><br><span class="line"><span class="string">var token = PubSub.subscribe( '</span>MY TOPIC<span class="string">', mySubscriber );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// unsubscribe this subscriber from this topic</span></span><br><span class="line"><span class="string">PubSub.unsubscribe( token );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Cancel all subscriptions for a function</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// create a function to receive the topic</span></span><br><span class="line"><span class="string">var mySubscriber = function( msg, data )&#123;</span></span><br><span class="line"><span class="string">    console.log( msg, data );</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// unsubscribe mySubscriber from ALL topics</span></span><br><span class="line"><span class="string">PubSub.unsubscribe( mySubscriber );</span></span><br><span class="line"><span class="string">Clear all subscriptions for a topic</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PubSub.subscribe('</span>a<span class="string">', myFunc1);</span></span><br><span class="line"><span class="string">PubSub.subscribe('</span>a.b<span class="string">', myFunc2);</span></span><br><span class="line"><span class="string">PubSub.subscribe('</span>a.b.c<span class="string">', myFunc3);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PubSub.unsubscribe('</span>a.b<span class="string">');</span></span><br><span class="line"><span class="string">// no further notications for '</span>a.b<span class="string">' and '</span>a.b.c<span class="string">' topics</span></span><br><span class="line"><span class="string">// notifications for '</span>a<span class="string">' will still get published</span></span><br><span class="line"><span class="string">Clear all subscriptions</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PubSub.clearAllSubscriptions();</span></span><br><span class="line"><span class="string">// all subscriptions are removed</span></span><br><span class="line"><span class="string">Hierarchical addressing</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// create a subscriber to receive all topics from a hierarchy of topics</span></span><br><span class="line"><span class="string">var myToplevelSubscriber = function( msg, data )&#123;</span></span><br><span class="line"><span class="string">    console.log( '</span>top level: <span class="string">', msg, data );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// subscribe to all topics in the '</span>car<span class="string">' hierarchy</span></span><br><span class="line"><span class="string">PubSub.subscribe( '</span>car<span class="string">', myToplevelSubscriber );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// create a subscriber to receive only leaf topic from hierarchy op topics</span></span><br><span class="line"><span class="string">var mySpecificSubscriber = function( msg, data )&#123;</span></span><br><span class="line"><span class="string">    console.log('</span>specific: <span class="string">', msg, data );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// subscribe only to '</span>car.drive<span class="string">' topics</span></span><br><span class="line"><span class="string">PubSub.subscribe( '</span>car.drive<span class="string">', mySpecificSubscriber );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Publish some topics</span></span><br><span class="line"><span class="string">PubSub.publish( '</span>car.purchase<span class="string">', &#123; name : '</span>my new car<span class="string">' &#125; );</span></span><br><span class="line"><span class="string">PubSub.publish( '</span>car.drive<span class="string">', &#123; speed : '</span>14<span class="string">' &#125; );</span></span><br><span class="line"><span class="string">PubSub.publish( '</span>car.sell<span class="string">', &#123; newOwner : '</span>someone <span class="keyword">else</span><span class="string">' &#125; );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// In this scenario, myToplevelSubscriber will be called for all</span></span><br><span class="line"><span class="string">// topics, three times in total</span></span><br><span class="line"><span class="string">// But, mySpecificSubscriber will only be called once, as it only</span></span><br><span class="line"><span class="string">// subscribes to the '</span>car.drive<span class="string">' topic</span></span><br></pre></td></tr></table></figure>

<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Example of use of <span class="string">"constants"</span></span><br><span class="line"></span><br><span class="line">// BAD</span><br><span class="line">PubSub.subscribe(<span class="string">"hello"</span>, <span class="keyword">function</span>( msg, data )&#123;</span><br><span class="line">	console.log( data )</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">PubSub.publish(<span class="string">"helo"</span>, <span class="string">"world"</span>);</span><br><span class="line"></span><br><span class="line">// BETTER</span><br><span class="line">var MY_TOPIC = <span class="string">"hello"</span>;</span><br><span class="line">PubSub.subscribe(MY_TOPIC, <span class="keyword">function</span>( msg, data )&#123;</span><br><span class="line">	console.log( data )</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">PubSub.publish(MY_TOPIC, <span class="string">"world"</span>);</span><br></pre></td></tr></table></figure>

 
        </div> 
      </article> 
</div>



    </main>
    </div>
  </body>
</html>