<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <title>koa-request | Aymfx&#39;s Blog</title>
  
  <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1408911_ujc2i49ntb.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
  <link rel="stylesheet" href="/blog2012View/css/style.css">
</head>
  <body>
    <div class='container'>
      <header id="header">
  <section class='header-main'>
    <div class='outer'>
        <a href="/blog2012View/" class="logo">Aymfx's Blog</a> 
      <nav class="navbar">
        
        <a href="/blog2012View/" class="menu-item-link">首页</a>
        
        <a href="/blog2012View/archives" class="menu-item-link">归档</a>
        
        <a href="/blog2012View/tags" class="menu-item-link">标签</a>
        
        <a href="/blog2012View/about" class="menu-item-link">关于我</a>
        
        <a href="/blog2012View/photos" class="menu-item-link">相册</a>
        
        <a href="https://github.com/aymfx" class="menu-item-link">交友</a>
        
      </nav>
    </div>
  </section>
</header>
    <main class="main">
      <div class='post-detail'>
    <div id="toc" class='left'>
    <h4>
        文章目录
    </h4>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#request-对象-分析"><span class="toc-text">request 对象 分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引用的包"><span class="toc-text">引用的包</span></a></li></ol>
</div>
    <article class="post-detail animated slideInDown right">
        <div class="post-title">
          <h2 class="title">koa-request</h2>
        </div>
         <div class="post-meta"> 
          <i class='iconfont iconriqi'></i>
          <span class="post-time">2019-09-11</span>
        </div>
        <div class="article-container">
          <blockquote>
<p>学习的koa源码</p>
</blockquote>
<a id="more"></a>  

<h2 id="request-对象-分析"><a href="#request-对象-分析" class="headerlink" title="request 对象 分析"></a>request 对象 分析</h2><h2 id="引用的包"><a href="#引用的包" class="headerlink" title="引用的包"></a>引用的包</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Module dependencies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> URL = <span class="built_in">require</span>(<span class="string">'url'</span>).URL;</span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"><span class="keyword">const</span> accepts = <span class="built_in">require</span>(<span class="string">'accepts'</span>); <span class="comment">// 允许接受的类型</span></span><br><span class="line"><span class="keyword">const</span> contentType = <span class="built_in">require</span>(<span class="string">'content-type'</span>); <span class="comment">// Create and parse HTTP Content-Type header according to RFC 7231</span></span><br><span class="line"><span class="keyword">const</span> stringify = <span class="built_in">require</span>(<span class="string">'url'</span>).format;</span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'parseurl'</span>);</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>); <span class="comment">// 解析body数据</span></span><br><span class="line"><span class="keyword">const</span> typeis = <span class="built_in">require</span>(<span class="string">'type-is'</span>);</span><br><span class="line"><span class="keyword">const</span> fresh = <span class="built_in">require</span>(<span class="string">'fresh'</span>); <span class="comment">// 刷新机制 不懂  英文太难了</span></span><br><span class="line"><span class="keyword">const</span> only = <span class="built_in">require</span>(<span class="string">'only'</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> IP = <span class="built_in">Symbol</span>(<span class="string">'context#ip'</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对象方法</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return request header.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Object&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> header() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.req.headers; <span class="comment">// 设置请求标头对象</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set request header.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> header(val) &#123;</span><br><span class="line">    <span class="comment">// 设置请求标头对象。</span></span><br><span class="line">    <span class="keyword">this</span>.req.headers = val;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return request header, alias as request.header</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Object&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> headers() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.req.headers;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set request header, alias as request.header</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> headers(val) &#123;</span><br><span class="line">    <span class="keyword">this</span>.req.headers = val;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get request URL.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> url() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.req.url; <span class="comment">// 获取请求 URL.</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set request URL.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> url(val) &#123;</span><br><span class="line">    <span class="comment">// 设置请求 URL, 对 url 重写有用。</span></span><br><span class="line">    <span class="keyword">this</span>.req.url = val;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get origin of URL.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> origin() &#123;</span><br><span class="line">    <span class="comment">// 获取URL的来源，包括 protocol 和 host。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.protocol&#125;</span>://<span class="subst">$&#123;<span class="keyword">this</span>.host&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get full request URL.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> href() &#123;</span><br><span class="line">    <span class="comment">// 获取完整的请求URL，包括 protocol，host 和 url。</span></span><br><span class="line">    <span class="comment">// support: `GET http://example.com/foo`</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^https?:\/\//i</span>.test(<span class="keyword">this</span>.originalUrl)) <span class="keyword">return</span> <span class="keyword">this</span>.originalUrl;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.origin + <span class="keyword">this</span>.originalUrl;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get request method.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> method() &#123;</span><br><span class="line">    <span class="comment">// 请求方法。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.req.method;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set request method.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String&#125; val</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> method(val) &#123;</span><br><span class="line">    <span class="comment">// 设置请求方法，对于实现诸如 methodOverride() 的中间件是有用的。</span></span><br><span class="line">    <span class="keyword">this</span>.req.method = val;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get request pathname.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> path() &#123;</span><br><span class="line">    <span class="comment">// 获取请求路径名。</span></span><br><span class="line">    <span class="keyword">return</span> parse(<span class="keyword">this</span>.req).pathname;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set pathname, retaining the query-string when present.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String&#125; path</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> path(path) &#123;</span><br><span class="line">    <span class="comment">// 设置请求路径名，并在存在时保留查询字符串。</span></span><br><span class="line">    <span class="keyword">const</span> url = parse(<span class="keyword">this</span>.req);</span><br><span class="line">    <span class="keyword">if</span> (url.pathname === path) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    url.pathname = path;</span><br><span class="line">    url.path = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.url = stringify(url);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get parsed query-string.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Object&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// 获取解析的查询字符串, 当没有查询字符串时，返回一个空对象。请注意，此 getter _不_ 支持嵌套解析。</span></span><br><span class="line">  <span class="keyword">get</span> query() &#123;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="keyword">this</span>.querystring;</span><br><span class="line">    <span class="keyword">const</span> c = (<span class="keyword">this</span>._querycache = <span class="keyword">this</span>._querycache || &#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span> c[str] || (c[str] = qs.parse(str));</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set query-string as an object.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;Object&#125; obj</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> query(obj) &#123;</span><br><span class="line">    <span class="comment">// 将查询字符串设置为给定对象。 请注意，此 setter _不_ 支持嵌套对象</span></span><br><span class="line">    <span class="keyword">this</span>.querystring = qs.stringify(obj);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get query string.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> querystring() &#123;</span><br><span class="line">    <span class="comment">// color=blue&amp;size=small  根据 ? 获取原始查询字符串.</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.req) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">return</span> parse(<span class="keyword">this</span>.req).query || <span class="string">''</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set querystring.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String&#125; str</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> querystring(str) &#123;</span><br><span class="line">    <span class="comment">// 设置原始查询字符串。</span></span><br><span class="line">    <span class="keyword">const</span> url = parse(<span class="keyword">this</span>.req);</span><br><span class="line">    <span class="keyword">if</span> (url.search === <span class="string">`?<span class="subst">$&#123;str&#125;</span>`</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    url.search = str;</span><br><span class="line">    url.path = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.url = stringify(url);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get the search string. Same as the querystring</span></span><br><span class="line"><span class="comment">   * except it includes the leading ?.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> search() &#123;</span><br><span class="line">    <span class="comment">// 设置原始查询字符串。</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.querystring) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`?<span class="subst">$&#123;<span class="keyword">this</span>.querystring&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set the search string. Same as</span></span><br><span class="line"><span class="comment">   * request.querystring= but included for ubiquity.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String&#125; str</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> search(str) &#123;</span><br><span class="line">    <span class="keyword">this</span>.querystring = str;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Parse the "Host" header field host</span></span><br><span class="line"><span class="comment">   * and support X-Forwarded-Host when a</span></span><br><span class="line"><span class="comment">   * proxy is enabled.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125; hostname:port</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> host() &#123;</span><br><span class="line">    <span class="keyword">const</span> proxy = <span class="keyword">this</span>.app.proxy; <span class="comment">// 当 app.proxy 是 true 时支持 X-Forwarded-Host，否则使用 Host。</span></span><br><span class="line">    <span class="keyword">let</span> host = proxy &amp;&amp; <span class="keyword">this</span>.get(<span class="string">'X-Forwarded-Host'</span>); <span class="comment">// 反向代理（负载均衡器，CDN）的主机名称和端口可能与处理请求的源服务器不同，在这种情况下，X-Forwarded-Host头部可用于确定最初使用哪个主机。</span></span><br><span class="line">    <span class="keyword">if</span> (!host) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.req.httpVersionMajor &gt;= <span class="number">2</span>) host = <span class="keyword">this</span>.get(<span class="string">':authority'</span>);</span><br><span class="line">      <span class="keyword">if</span> (!host) host = <span class="keyword">this</span>.get(<span class="string">'Host'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!host) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">return</span> host.split(<span class="regexp">/\s*,\s*/</span>, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Parse the "Host" header field hostname</span></span><br><span class="line"><span class="comment">   * and support X-Forwarded-Host when a</span></span><br><span class="line"><span class="comment">   * proxy is enabled.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125; hostname</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> hostname() &#123;</span><br><span class="line">    <span class="comment">// 存在时获取主机名。当 app.proxy 是 true 时支持 X-Forwarded-Host，否则使用 Host。</span></span><br><span class="line">    <span class="keyword">const</span> host = <span class="keyword">this</span>.host;</span><br><span class="line">    <span class="keyword">if</span> (!host) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'['</span> == host[<span class="number">0</span>]) <span class="keyword">return</span> <span class="keyword">this</span>.URL.hostname || <span class="string">''</span>; <span class="comment">// IPv6</span></span><br><span class="line">    <span class="keyword">return</span> host.split(<span class="string">':'</span>, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get WHATWG parsed URL.</span></span><br><span class="line"><span class="comment">   * Lazily memoized.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;URL|Object&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> URL() &#123;</span><br><span class="line">    <span class="comment">// 获取 WHATWG 解析的 URL 对象。</span></span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.memoizedURL) &#123;</span><br><span class="line">      <span class="keyword">const</span> protocol = <span class="keyword">this</span>.protocol;</span><br><span class="line">      <span class="keyword">const</span> host = <span class="keyword">this</span>.host;</span><br><span class="line">      <span class="keyword">const</span> originalUrl = <span class="keyword">this</span>.originalUrl || <span class="string">''</span>; <span class="comment">// avoid undefined in template string</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.memoizedURL = <span class="keyword">new</span> URL(<span class="string">`<span class="subst">$&#123;protocol&#125;</span>://<span class="subst">$&#123;host&#125;</span><span class="subst">$&#123;originalUrl&#125;</span>`</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">this</span>.memoizedURL = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.memoizedURL;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Check if the request is fresh, aka</span></span><br><span class="line"><span class="comment">   * Last-Modified and/or the ETag</span></span><br><span class="line"><span class="comment">   * still match.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Boolean&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> fresh() &#123;</span><br><span class="line">    <span class="comment">// 检查请求缓存是否“新鲜”，也就是内容没有改变。此方法用于 If-None-Match / ETag, 和 If-Modified-Since 和 Last-Modified 之间的缓存协商。 在设置一个或多个这些响应头后应该引用它</span></span><br><span class="line">    <span class="keyword">const</span> method = <span class="keyword">this</span>.method;</span><br><span class="line">    <span class="keyword">const</span> s = <span class="keyword">this</span>.ctx.status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// GET or HEAD for weak freshness validation only</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'GET'</span> != method &amp;&amp; <span class="string">'HEAD'</span> != method) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2xx or 304 as per rfc2616 14.26</span></span><br><span class="line">    <span class="keyword">if</span> ((s &gt;= <span class="number">200</span> &amp;&amp; s &lt; <span class="number">300</span>) || <span class="number">304</span> == s) &#123;</span><br><span class="line">      <span class="keyword">return</span> fresh(<span class="keyword">this</span>.header, <span class="keyword">this</span>.response.header);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Check if the request is stale, aka</span></span><br><span class="line"><span class="comment">   * "Last-Modified" and / or the "ETag" for the</span></span><br><span class="line"><span class="comment">   * resource has changed.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Boolean&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> stale() &#123;</span><br><span class="line">    <span class="comment">// 相反与 request.fresh.</span></span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">this</span>.fresh;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Check if the request is idempotent.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Boolean&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> idempotent() &#123;</span><br><span class="line">    <span class="comment">// 检查请求是否是幂等的。</span></span><br><span class="line">    <span class="keyword">const</span> methods = [<span class="string">'GET'</span>, <span class="string">'HEAD'</span>, <span class="string">'PUT'</span>, <span class="string">'DELETE'</span>, <span class="string">'OPTIONS'</span>, <span class="string">'TRACE'</span>];</span><br><span class="line">    <span class="keyword">return</span> !!~methods.indexOf(<span class="keyword">this</span>.method);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return the request socket.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Connection&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> socket() &#123;</span><br><span class="line">    <span class="comment">// 返回请求套接字。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.req.socket;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get the charset when present or undefined.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> charset() &#123;</span><br><span class="line">    <span class="comment">// 在存在时获取请求字符集，或者 undefined：</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; parameters &#125; = contentType.parse(<span class="keyword">this</span>.req);</span><br><span class="line">      <span class="keyword">return</span> parameters.charset || <span class="string">''</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return parsed Content-Length when present.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Number&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> length() &#123;</span><br><span class="line">    <span class="comment">// 返回以数字返回请求的 Content-Length，或 undefined。</span></span><br><span class="line">    <span class="keyword">const</span> len = <span class="keyword">this</span>.get(<span class="string">'Content-Length'</span>);</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="string">''</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">return</span> ~~len;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return the protocol string "http" or "https"</span></span><br><span class="line"><span class="comment">   * when requested with TLS. When the proxy setting</span></span><br><span class="line"><span class="comment">   * is enabled the "X-Forwarded-Proto" header</span></span><br><span class="line"><span class="comment">   * field will be trusted. If you're running behind</span></span><br><span class="line"><span class="comment">   * a reverse proxy that supplies https for you this</span></span><br><span class="line"><span class="comment">   * may be enabled.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> protocol() &#123;</span><br><span class="line">    <span class="comment">// 返回请求协议，“https” 或 “http”。当 app.proxy 是 true 时支持 X-Forwarded-Proto。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.socket.encrypted) <span class="keyword">return</span> <span class="string">'https'</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.app.proxy) <span class="keyword">return</span> <span class="string">'http'</span>;</span><br><span class="line">    <span class="keyword">const</span> proto = <span class="keyword">this</span>.get(<span class="string">'X-Forwarded-Proto'</span>);</span><br><span class="line">    <span class="keyword">return</span> proto ? proto.split(<span class="regexp">/\s*,\s*/</span>, <span class="number">1</span>)[<span class="number">0</span>] : <span class="string">'http'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Short-hand for:</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *    this.protocol == 'https'</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Boolean&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> secure() &#123;</span><br><span class="line">    <span class="comment">// 安全性 通过 ctx.protocol == "https" 来检查请求是否通过 TLS 发出。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'https'</span> == <span class="keyword">this</span>.protocol;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * When `app.proxy` is `true`, parse</span></span><br><span class="line"><span class="comment">   * the "X-Forwarded-For" ip address list.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * For example if the value were "client, proxy1, proxy2"</span></span><br><span class="line"><span class="comment">   * you would receive the array `["client", "proxy1", "proxy2"]`</span></span><br><span class="line"><span class="comment">   * where "proxy2" is the furthest down-stream.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Array&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> ips() &#123;</span><br><span class="line">    <span class="comment">// 当 X-Forwarded-For 存在并且 app.proxy 被启用时，这些 ips 的数组被返回，从上游 - &gt;下游排序。 禁用时返回一个空数组。</span></span><br><span class="line">    <span class="keyword">const</span> proxy = <span class="keyword">this</span>.app.proxy;</span><br><span class="line">    <span class="keyword">const</span> val = <span class="keyword">this</span>.get(<span class="string">'X-Forwarded-For'</span>);</span><br><span class="line">    <span class="keyword">return</span> proxy &amp;&amp; val ? val.split(<span class="regexp">/\s*,\s*/</span>) : [];</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return request's remote address</span></span><br><span class="line"><span class="comment">   * When `app.proxy` is `true`, parse</span></span><br><span class="line"><span class="comment">   * the "X-Forwarded-For" ip address list and return the first one</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> ip() &#123;</span><br><span class="line">    <span class="comment">// 请求远程地址。 当 app.proxy 是 true 时支持 X-Forwarded-Proto。</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>[IP]) &#123;</span><br><span class="line">      <span class="keyword">this</span>[IP] = <span class="keyword">this</span>.ips[<span class="number">0</span>] || <span class="keyword">this</span>.socket.remoteAddress || <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[IP];</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> ip(_ip) &#123;</span><br><span class="line">    <span class="keyword">this</span>[IP] = _ip;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return subdomains as an array.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Subdomains are the dot-separated parts of the host before the main domain</span></span><br><span class="line"><span class="comment">   * of the app. By default, the domain of the app is assumed to be the last two</span></span><br><span class="line"><span class="comment">   * parts of the host. This can be changed by setting `app.subdomainOffset`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * For example, if the domain is "tobi.ferrets.example.com":</span></span><br><span class="line"><span class="comment">   * If `app.subdomainOffset` is not set, this.subdomains is</span></span><br><span class="line"><span class="comment">   * `["ferrets", "tobi"]`.</span></span><br><span class="line"><span class="comment">   * If `app.subdomainOffset` is 3, this.subdomains is `["tobi"]`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Array&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> subdomains() &#123;</span><br><span class="line">    <span class="comment">// 子域是应用程序主域之前主机的点分隔部分。默认情况下，应用程序的域名假定为主机的最后两个部分。这可以通过设置 app.subdomainOffset 来更改。</span></span><br><span class="line">    <span class="keyword">const</span> offset = <span class="keyword">this</span>.app.subdomainOffset;</span><br><span class="line">    <span class="keyword">const</span> hostname = <span class="keyword">this</span>.hostname;</span><br><span class="line">    <span class="keyword">if</span> (net.isIP(hostname)) <span class="keyword">return</span> [];</span><br><span class="line">    <span class="keyword">return</span> hostname</span><br><span class="line">      .split(<span class="string">'.'</span>)</span><br><span class="line">      .reverse()</span><br><span class="line">      .slice(offset);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Get accept object.</span></span><br><span class="line"><span class="comment">   * Lazily memoized.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Object&#125;</span></span><br><span class="line"><span class="comment">   * @api private</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">get</span> accept() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._accept || (<span class="keyword">this</span>._accept = accepts(<span class="keyword">this</span>.req));</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Set accept object.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;Object&#125;</span></span><br><span class="line"><span class="comment">   * @api private</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">set</span> accept(obj) &#123;</span><br><span class="line">    <span class="keyword">this</span>._accept = obj;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Check if the given `type(s)` is acceptable, returning</span></span><br><span class="line"><span class="comment">   * the best match when true, otherwise `false`, in which</span></span><br><span class="line"><span class="comment">   * case you should respond with 406 "Not Acceptable".</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * The `type` value may be a single mime type string</span></span><br><span class="line"><span class="comment">   * such as "application/json", the extension name</span></span><br><span class="line"><span class="comment">   * such as "json" or an array `["json", "html", "text/plain"]`. When a list</span></span><br><span class="line"><span class="comment">   * or array is given the _best_ match, if any is returned.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Examples:</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     // Accept: text/html</span></span><br><span class="line"><span class="comment">   *     this.accepts('html');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "html"</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     // Accept: text/*, application/json</span></span><br><span class="line"><span class="comment">   *     this.accepts('html');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "html"</span></span><br><span class="line"><span class="comment">   *     this.accepts('text/html');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "text/html"</span></span><br><span class="line"><span class="comment">   *     this.accepts('json', 'text');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "json"</span></span><br><span class="line"><span class="comment">   *     this.accepts('application/json');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "application/json"</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     // Accept: text/*, application/json</span></span><br><span class="line"><span class="comment">   *     this.accepts('image/png');</span></span><br><span class="line"><span class="comment">   *     this.accepts('png');</span></span><br><span class="line"><span class="comment">   *     // =&gt; false</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     // Accept: text/*;q=.5, application/json</span></span><br><span class="line"><span class="comment">   *     this.accepts(['html', 'json']);</span></span><br><span class="line"><span class="comment">   *     this.accepts('html', 'json');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "json"</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String|Array&#125; type(s)...</span></span><br><span class="line"><span class="comment">   * @return &#123;String|Array|false&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  accepts(...args) &#123;</span><br><span class="line">    <span class="comment">// 检查给定的 type(s) 是否可以接受，如果 true，返回最佳匹配，否则为 false。 type 值可能是一个或多个 mime 类型的字符串，如 application/json，扩展名称如 json，或数组 ["json", "html", "text/plain"]。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.accept.types(...args);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return accepted encodings or best fit based on `encodings`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Given `Accept-Encoding: gzip, deflate`</span></span><br><span class="line"><span class="comment">   * an array sorted by quality is returned:</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     ['gzip', 'deflate']</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String|Array&#125; encoding(s)...</span></span><br><span class="line"><span class="comment">   * @return &#123;String|Array&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  acceptsEncodings(...args) &#123;</span><br><span class="line">    <span class="comment">// 检查 encodings 是否可以接受，返回最佳匹配为 true，否则为 false。 请注意，您应该将identity 作为编码之一！</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.accept.encodings(...args);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return accepted charsets or best fit based on `charsets`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Given `Accept-Charset: utf-8, iso-8859-1;q=0.2, utf-7;q=0.5`</span></span><br><span class="line"><span class="comment">   * an array sorted by quality is returned:</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     ['utf-8', 'utf-7', 'iso-8859-1']</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String|Array&#125; charset(s)...</span></span><br><span class="line"><span class="comment">   * @return &#123;String|Array&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  acceptsCharsets(...args) &#123;</span><br><span class="line">    <span class="comment">// 检查 charsets 是否可以接受，在 true 时返回最佳匹配，否则为 false。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.accept.charsets(...args);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return accepted languages or best fit based on `langs`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Given `Accept-Language: en;q=0.8, es, pt`</span></span><br><span class="line"><span class="comment">   * an array sorted by quality is returned:</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     ['es', 'pt', 'en']</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String|Array&#125; lang(s)...</span></span><br><span class="line"><span class="comment">   * @return &#123;Array|String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  acceptsLanguages(...args) &#123;</span><br><span class="line">    <span class="comment">// 检查 langs 是否可以接受，如果为 true，返回最佳匹配，否则为 false。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.accept.languages(...args);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Check if the incoming request contains the "Content-Type"</span></span><br><span class="line"><span class="comment">   * header field, and it contains any of the give mime `type`s.</span></span><br><span class="line"><span class="comment">   * If there is no request body, `null` is returned.</span></span><br><span class="line"><span class="comment">   * If there is no content type, `false` is returned.</span></span><br><span class="line"><span class="comment">   * Otherwise, it returns the first `type` that matches.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Examples:</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     // With Content-Type: text/html; charset=utf-8</span></span><br><span class="line"><span class="comment">   *     this.is('html'); // =&gt; 'html'</span></span><br><span class="line"><span class="comment">   *     this.is('text/html'); // =&gt; 'text/html'</span></span><br><span class="line"><span class="comment">   *     this.is('text/*', 'application/json'); // =&gt; 'text/html'</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     // When Content-Type is application/json</span></span><br><span class="line"><span class="comment">   *     this.is('json', 'urlencoded'); // =&gt; 'json'</span></span><br><span class="line"><span class="comment">   *     this.is('application/json'); // =&gt; 'application/json'</span></span><br><span class="line"><span class="comment">   *     this.is('html', 'application/*'); // =&gt; 'application/json'</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     this.is('html'); // =&gt; false</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String|Array&#125; types...</span></span><br><span class="line"><span class="comment">   * @return &#123;String|false|null&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  is(types) &#123;</span><br><span class="line">    <span class="comment">// 检查传入请求是否包含 Content-Type 头字段， 并且包含任意的 mime type。 如果没有请求主体，返回 null。 如果没有内容类型，或者匹配失败，则返回 false。 反之则返回匹配的 content-type。</span></span><br><span class="line">    <span class="keyword">if</span> (!types) <span class="keyword">return</span> typeis(<span class="keyword">this</span>.req);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(types)) types = [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> typeis(<span class="keyword">this</span>.req, types);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return the request mime type void of</span></span><br><span class="line"><span class="comment">   * parameters such as "charset".</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> type() &#123;</span><br><span class="line">    <span class="comment">// 获取请求 Content-Type 不含参数 "charset"。</span></span><br><span class="line">    <span class="keyword">const</span> type = <span class="keyword">this</span>.get(<span class="string">'Content-Type'</span>);</span><br><span class="line">    <span class="keyword">if</span> (!type) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">return</span> type.split(<span class="string">';'</span>)[<span class="number">0</span>];</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return request header.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * The `Referrer` header field is special-cased,</span></span><br><span class="line"><span class="comment">   * both `Referrer` and `Referer` are interchangeable.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Examples:</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     this.get('Content-Type');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "text/plain"</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     this.get('content-type');</span></span><br><span class="line"><span class="comment">   *     // =&gt; "text/plain"</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *     this.get('Something');</span></span><br><span class="line"><span class="comment">   *     // =&gt; ''</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param &#123;String&#125; field</span></span><br><span class="line"><span class="comment">   * @return &#123;String&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span>(field) &#123;</span><br><span class="line">    <span class="comment">// 返回请求标头。</span></span><br><span class="line">    <span class="keyword">const</span> req = <span class="keyword">this</span>.req;</span><br><span class="line">    <span class="keyword">switch</span> ((field = field.toLowerCase())) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'referer'</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'referrer'</span>:</span><br><span class="line">        <span class="keyword">return</span> req.headers.referrer || req.headers.referer || <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> req.headers[field] || <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Inspect implementation.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Object&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  inspect() &#123;</span><br><span class="line">    <span class="comment">// 白名单</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.req) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.toJSON();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return JSON representation.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @return &#123;Object&#125;</span></span><br><span class="line"><span class="comment">   * @api public</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  toJSON() &#123;</span><br><span class="line">    <span class="keyword">return</span> only(<span class="keyword">this</span>, [<span class="string">'method'</span>, <span class="string">'url'</span>, <span class="string">'header'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>白名单</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Custom inspection implementation for newer Node.js versions.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return &#123;Object&#125;</span></span><br><span class="line"><span class="comment"> * @api public</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* istanbul ignore else */</span></span><br><span class="line"><span class="keyword">if</span> (util.inspect.custom) &#123;</span><br><span class="line">  <span class="comment">// 老操作</span></span><br><span class="line">  <span class="built_in">module</span>.exports[util.inspect.custom] = <span class="built_in">module</span>.exports.inspect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 
        </div> 
      </article> 
</div>



    </main>
    </div>
  </body>
</html>